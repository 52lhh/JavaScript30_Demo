<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <!-- <li>Filter for a city</li>
      <li>or a state</li> -->
    </ul>
  </form>
  <script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

    // fetch()æ–¹æ³•æ˜¯XMLHTTPRequest()çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè¾ƒä¹‹ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ï¼Œç”¨äºè·¨ç½‘ç»œå¼‚æ­¥è·å–èµ„æº
    // 1. è·å–æ•°æ®
    const cities = [];
    fetch(endpoint)
      .then(response => response.json())
      .then(data => {
        cities.push(...data);
        console.log(cities);
      });

    // 2. ç­›é€‰æ•°æ®
    function findMatches(searchMetches, cities) {
      // å°†é€šè¿‡ç­›é€‰åçš„æ•°æ®è¿”å›
      return cities.filter(function (data) {
        // ç¬¬äºŒä¸ªå‚æ•°ï¼šgä»£è¡¨å…¨å±€åŒ¹é…ï¼Œiä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™
        const regex1 = new RegExp(searchMetches, 'gi');
        return data.city.match(regex1) || data.state.match(regex1);
      })
    }

    // 3. å±•ç¤ºæ•°æ®
    function showMatches() {
      // è°ƒç”¨ç­›é€‰æ•°æ®çš„å‡½æ•°
      const matchesArray = findMatches(this.value, cities);
      // åˆ©ç”¨mapå¤„ç†æ•°ç»„å…ƒç´ 
      const lis = matchesArray.map(item => {
        // ç¬¬äºŒä¸ªå‚æ•°ï¼šgä»£è¡¨å…¨å±€åŒ¹é…ï¼Œiä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™
        const regex2 = new RegExp(this.value, 'gi')
        // replace()æ–¹æ³•å¯ä»¥å®ç°æ›¿æ¢å­—ç¬¦ä¸²æ“ä½œï¼Œç”¨æ¥æ›¿æ¢çš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼
        const ItemCity = item.city.replace(regex2, `<span class="hl">${this.value}</span>`)
        const ItemState = item.state.replace(regex2, `<span class="hl">${this.value}</span>`)

        return `
          <li>
            <span class="name">${ItemCity}, ${ItemState}</span>  
            <span class="population">${numberWith(item.population)}</span>  
          </li>
        `
      }).join('')

      suggestions.innerHTML = lis;
      // å½“è¾“å…¥æ¡†ä¸ºç©ºæ—¶ï¼Œå¼¹å‡ºæ¶ˆæ¯æ¶ˆå¤±
      if (!this.value) {
        suggestions.innerHTML = '';
      }
    }

    // è½¬æ¢æ•°å­—æ ¼å¼çš„æ­£åˆ™è¡¨è¾¾å¼
    function numberWith(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
    }

    // å°†æ•°ç»„å…ƒç´ å†…çš„liæ’å…¥ulä¸­
    // è·å–ul
    const suggestions = document.querySelector(".suggestions");

    // è·å–è¾“å…¥æ¡†ä¸­çš„å€¼
    const searchInput = document.querySelector(".search");
    // å½“è§¦å‘changeäº‹ä»¶æ—¶ï¼Œè°ƒç”¨showMatcheså‡½æ•°
    searchInput.addEventListener("change", showMatches);
    // å½“è§¦å‘keyupäº‹ä»¶æ—¶ï¼Œè°ƒç”¨showMatcheså‡½æ•°
    searchInput.addEventListener("keyup", showMatches);
  </script>
</body>

</html>